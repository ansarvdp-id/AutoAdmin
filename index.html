<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ - ‡¶Ö‡¶ü‡ßã ‡¶Æ‡ßá‡¶ï‡¶æ‡¶®‡¶ø‡¶ï</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    
    <style>
        body { background-color: #f0f2f5; font-family: 'Kalpurush', sans-serif; }
        .sidebar { min-height: 100vh; background: #343a40; color: white; }
        .nav-link { color: rgba(255,255,255,.8); cursor: pointer; margin-bottom: 5px; }
        .nav-link:hover, .nav-link.active { color: #fff; background: rgba(255,255,255,0.1); border-radius: 5px; }
        .card { border: none; shadow-sm: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.8); z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .hidden { display: none !important; }
    </style>
</head>
<body>

<!-- Loading Spinner -->
<div id="loading" class="loading-overlay hidden">
    <div class="spinner-border text-primary" role="status"></div>
</div>

<!-- Login Section -->
<div id="loginSection" class="container mt-5" style="max-width: 400px;">
    <div class="card p-4">
        <h3 class="text-center mb-4">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶á‡¶®</h3>
        <input type="email" id="adminEmail" class="form-control mb-3" placeholder="‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶á‡¶Æ‡ßá‡¶á‡¶≤">
        <input type="password" id="adminPass" class="form-control mb-3" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°">
        <button onclick="adminLogin()" class="btn btn-dark w-100">‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>
</div>

<!-- Dashboard Section -->
<div id="dashboardSection" class="container-fluid hidden">
    <div class="row">
        <!-- Sidebar -->
        <nav class="col-md-3 col-lg-2 d-md-block sidebar p-3 collapse show" id="sidebarMenu">
            <h5 class="mb-4 py-2 border-bottom">üîß ‡¶Æ‡ßá‡¶ï‡¶æ‡¶®‡¶ø‡¶ï ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®</h5>
            <ul class="nav flex-column">
                <li class="nav-item"><a class="nav-link active" onclick="showTab('keys')"><i class="fas fa-key me-2"></i> ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶ü‡¶ø‡¶≠‡ßá‡¶∂‡¶® ‡¶ï‡¶ø</a></li>
                <li class="nav-item"><a class="nav-link" onclick="showTab('slider')"><i class="fas fa-images me-2"></i> ‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶ú</a></li>
                <li class="nav-item"><a class="nav-link" onclick="showTab('questions')"><i class="fas fa-question-circle me-2"></i> ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</a></li>
                <li class="nav-item"><a class="nav-link" onclick="showTab('mcq')"><i class="fas fa-list-check me-2"></i> MCQ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</a></li>
                <li class="nav-item"><a class="nav-link" onclick="showTab('truefalse')"><i class="fas fa-check-square me-2"></i> ‡¶∏‡¶§‡ßç‡¶Ø/‡¶Æ‡¶ø‡¶•‡ßç‡¶Ø‡¶æ</a></li>
                <li class="nav-item"><a class="nav-link" onclick="showTab('translate')"><i class="fas fa-language me-2"></i> ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶≤‡ßá‡¶ü</a></li>
                <li class="nav-item mt-5"><a class="nav-link text-danger" onclick="logout()"><i class="fas fa-sign-out-alt me-2"></i> ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 py-4">
            
            <!-- Generate Keys Tab -->
            <div id="tab-keys" class="content-tab">
                <h3>üîë ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡¶æ‡¶á‡¶∏‡ßá‡¶®‡ßç‡¶∏ ‡¶ï‡¶ø ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <div class="card p-4 mt-3" style="max-width: 500px;">
                    <label class="form-label">‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</label>
                    <select id="keyDuration" class="form-select mb-3">
                        <option value="7">‡ß≠ ‡¶¶‡¶ø‡¶®</option>
                        <option value="10">‡ßß‡ß¶ ‡¶¶‡¶ø‡¶®</option>
                        <option value="15">‡ßß‡ß´ ‡¶¶‡¶ø‡¶®</option>
                        <option value="30">‡ß©‡ß¶ ‡¶¶‡¶ø‡¶®</option>
                    </select>
                    <button onclick="generateKey()" class="btn btn-success">‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü ‡¶ï‡¶ø (Generate Key)</button>
                    
                    <div id="keyResult" class="alert alert-success mt-3 hidden">
                        <h4 id="newKeyDisplay" class="fw-bold"></h4>
                        <p class="mb-0">‡¶è‡¶á ‡¶ï‡¶ø ‡¶ü‡¶ø ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßá ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ‡¶¶‡¶ø‡¶®‡•§</p>
                    </div>
                </div>
            </div>

            <!-- Slider Tab -->
            <div id="tab-slider" class="content-tab hidden">
                <h3>üñºÔ∏è ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°‡¶æ‡¶∞ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü</h3>
                <div class="card p-4 mt-3">
                    <p class="text-muted">‡¶á‡¶Æ‡ßá‡¶ú ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶¶‡¶ø‡¶®‡•§</p>
                    
                    <div class="mb-3">
                        <label>‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶° ‡ßß</label>
                        <div class="input-group">
                            <input type="file" class="form-control" id="fileSlide1">
                            <button class="btn btn-outline-secondary" onclick="uploadImage('fileSlide1', 'urlSlide1')">‡¶Ü‡¶™‡¶≤‡ßã‡¶°</button>
                        </div>
                        <input type="text" id="urlSlide1" class="form-control mt-1" placeholder="Image URL">
                    </div>

                    <div class="mb-3">
                        <label>‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶° ‡ß®</label>
                        <div class="input-group">
                            <input type="file" class="form-control" id="fileSlide2">
                            <button class="btn btn-outline-secondary" onclick="uploadImage('fileSlide2', 'urlSlide2')">‡¶Ü‡¶™‡¶≤‡ßã‡¶°</button>
                        </div>
                        <input type="text" id="urlSlide2" class="form-control mt-1" placeholder="Image URL">
                    </div>

                    <div class="mb-3">
                        <label>‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶° ‡ß©</label>
                        <div class="input-group">
                            <input type="file" class="form-control" id="fileSlide3">
                            <button class="btn btn-outline-secondary" onclick="uploadImage('fileSlide3', 'urlSlide3')">‡¶Ü‡¶™‡¶≤‡ßã‡¶°</button>
                        </div>
                        <input type="text" id="urlSlide3" class="form-control mt-1" placeholder="Image URL">
                    </div>

                    <button onclick="updateSlider()" class="btn btn-primary">‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°‡¶æ‡¶∞ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>

            <!-- Questions Tab -->
            <div id="tab-questions" class="content-tab hidden">
                <h3>‚ùì ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <div class="card p-4 mt-3">
                    <input type="text" id="qTitle" class="form-control mb-2" placeholder="‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...">
                    <textarea id="qAns" class="form-control mb-2" rows="4" placeholder="‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></textarea>
                    
                    <label>‡¶õ‡¶¨‡¶ø (‡¶Ö‡¶™‡¶∂‡¶®‡¶æ‡¶≤)</label>
                    <div class="input-group mb-3">
                        <input type="file" class="form-control" id="fileQ">
                        <button class="btn btn-outline-secondary" onclick="uploadImage('fileQ', 'urlQ')">‡¶Ü‡¶™‡¶≤‡ßã‡¶°</button>
                    </div>
                    <input type="hidden" id="urlQ">
                    
                    <button onclick="addQuestion()" class="btn btn-info text-white">‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>

            <!-- MCQ Tab -->
            <div id="tab-mcq" class="content-tab hidden">
                <h3>üìù MCQ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <div class="card p-4 mt-3">
                    <input type="text" id="mcqTitle" class="form-control mb-3" placeholder="MCQ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®...">
                    
                    <div class="row g-2 mb-3">
                        <div class="col-6"><input type="text" id="opt1" class="form-control" placeholder="‡¶Ö‡¶™‡¶∂‡¶® ‡ßß"></div>
                        <div class="col-6"><input type="text" id="opt2" class="form-control" placeholder="‡¶Ö‡¶™‡¶∂‡¶® ‡ß®"></div>
                        <div class="col-6"><input type="text" id="opt3" class="form-control" placeholder="‡¶Ö‡¶™‡¶∂‡¶® ‡ß©"></div>
                        <div class="col-6"><input type="text" id="opt4" class="form-control" placeholder="‡¶Ö‡¶™‡¶∂‡¶® ‡ß™"></div>
                    </div>

                    <label>‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶ï‡ßã‡¶®‡¶ü‡¶ø?</label>
                    <select id="mcqCorrect" class="form-select mb-3">
                        <option value="1">‡¶Ö‡¶™‡¶∂‡¶® ‡ßß</option>
                        <option value="2">‡¶Ö‡¶™‡¶∂‡¶® ‡ß®</option>
                        <option value="3">‡¶Ö‡¶™‡¶∂‡¶® ‡ß©</option>
                        <option value="4">‡¶Ö‡¶™‡¶∂‡¶® ‡ß™</option>
                    </select>

                    <button onclick="addMCQ()" class="btn btn-warning">MCQ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>

            <!-- True/False Tab -->
            <div id="tab-truefalse" class="content-tab hidden">
                <h3>‚úÖ ‡¶∏‡¶§‡ßç‡¶Ø / ‡¶Æ‡¶ø‡¶•‡ßç‡¶Ø‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <div class="card p-4 mt-3">
                    <input type="text" id="tfTitle" class="form-control mb-3" placeholder="‡¶¨‡¶æ‡¶ï‡ßç‡¶Ø‡¶ü‡¶ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...">
                    <select id="tfCorrect" class="form-select mb-3">
                        <option value="‡¶∏‡¶§‡ßç‡¶Ø">‡¶∏‡¶§‡ßç‡¶Ø (True)</option>
                        <option value="‡¶Æ‡¶ø‡¶•‡ßç‡¶Ø‡¶æ">‡¶Æ‡¶ø‡¶•‡ßç‡¶Ø‡¶æ (False)</option>
                    </select>
                    <button onclick="addTrueFalse()" class="btn btn-secondary">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>

             <!-- Translate Tab -->
             <div id="tab-translate" class="content-tab hidden">
                <h3>üî§ ‡¶Ö‡¶®‡ßÅ‡¶¨‡¶æ‡¶¶ (Translate) ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <div class="card p-4 mt-3">
                    <div class="mb-2">
                        <label>‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶¨‡¶æ‡¶ï‡ßç‡¶Ø</label>
                        <input type="text" id="transBn" class="form-control" placeholder="‡¶Ü‡¶Æ‡¶ø ‡¶Æ‡ßá‡¶ï‡¶æ‡¶®‡¶ø‡¶ï...">
                    </div>
                    <div class="mb-3">
                        <label>‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø ‡¶Ö‡¶®‡ßÅ‡¶¨‡¶æ‡¶¶</label>
                        <input type="text" id="transEn" class="form-control" placeholder="I am a mechanic...">
                    </div>
                    <button onclick="addTranslate()" class="btn btn-dark">‡¶Ö‡¶®‡ßÅ‡¶¨‡¶æ‡¶¶ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>

        </main>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

<!-- Firebase SDK -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, collection, addDoc, Timestamp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBEfs_yi_U5AObahTTLQGK5Sj4k1wSBXb0",
        authDomain: "ansar-vdp.firebaseapp.com",
        projectId: "ansar-vdp",
        storageBucket: "ansar-vdp.firebasestorage.app",
        messagingSenderId: "934221161236",
        appId: "1:934221161236:web:bd4797c63c4fd5418f9801"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // -- UTILITIES --
    window.showToast = (msg, type="success") => {
        let bg = type === "error" ? "red" : "green";
        Toastify({ text: msg, duration: 3000, style: { background: bg } }).showToast();
    }

    window.toggleLoading = (show) => {
        document.getElementById("loading").classList.toggle("hidden", !show);
    }

    window.showTab = (tabId) => {
        document.querySelectorAll('.content-tab').forEach(el => el.classList.add('hidden'));
        document.getElementById('tab-' + tabId).classList.remove('hidden');
        
        document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
        event.target.closest('.nav-link').classList.add('active');
    }

    // -- AUTH --
    window.adminLogin = async () => {
        const email = document.getElementById("adminEmail").value;
        const pass = document.getElementById("adminPass").value;
        
        toggleLoading(true);
        try {
            const userCred = await signInWithEmailAndPassword(auth, email, pass);
            checkIsAdmin(userCred.user.uid);
        } catch (error) {
            showToast("‡¶≤‡¶ó‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•! ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§", "error");
            toggleLoading(false);
        }
    }

    async function checkIsAdmin(uid) {
        const userDoc = await getDoc(doc(db, "users", uid));
        if(userDoc.exists() && userDoc.data().isAdmin === true) {
            document.getElementById("loginSection").classList.add("hidden");
            document.getElementById("dashboardSection").classList.remove("hidden");
            showToast("‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ");
        } else {
            showToast("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶®‡ßá‡¶á!", "error");
            signOut(auth);
        }
        toggleLoading(false);
    }

    onAuthStateChanged(auth, (user) => {
        if(user) {
            checkIsAdmin(user.uid);
        } else {
            document.getElementById("loginSection").classList.remove("hidden");
            document.getElementById("dashboardSection").classList.add("hidden");
        }
    });

    window.logout = () => {
        signOut(auth);
    }

    // -- CLOUDINARY UPLOAD --
    window.uploadImage = async (inputId, outputId) => {
        const file = document.getElementById(inputId).files[0];
        if(!file) return showToast("‡¶õ‡¶¨‡¶ø ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®", "error");

        toggleLoading(true);
        const formData = new FormData();
        formData.append("file", file);
        formData.append("upload_preset", "ml_default");
        formData.append("cloud_name", "dntvrm1wn");

        try {
            let res = await fetch("https://api.cloudinary.com/v1_1/dntvrm1wn/image/upload", {
                method: "POST",
                body: formData
            });
            let data = await res.json();
            document.getElementById(outputId).value = data.secure_url;
            showToast("‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶∏‡¶´‡¶≤!");
        } catch (error) {
            showToast("‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•", "error");
        } finally {
            toggleLoading(false);
        }
    }

    // -- FEATURES (FIXED FOR USER APP) --

    // 1. Generate Key
    window.generateKey = async () => {
        const days = document.getElementById("keyDuration").value;
        const newKey = "AUTO-" + Math.floor(100000 + Math.random() * 900000); 

        toggleLoading(true);
        try {
            await addDoc(collection(db, "activation_keys"), {
                key: newKey,
                days: parseInt(days),
                used: false,
                createdAt: Timestamp.now()
            });
            document.getElementById("newKeyDisplay").innerText = newKey;
            document.getElementById("keyResult").classList.remove("hidden");
            showToast("‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶ø ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
        } catch (e) {
            showToast("‡¶è‡¶∞‡¶∞ ‡¶π‡ßü‡ßá‡¶õ‡ßá", "error");
        } finally {
            toggleLoading(false);
        }
    }

    // 2. Update Slider
    window.updateSlider = async () => {
        const u1 = document.getElementById("urlSlide1").value;
        const u2 = document.getElementById("urlSlide2").value;
        const u3 = document.getElementById("urlSlide3").value;

        if(!u1) return showToast("‡¶Ö‡¶®‡ßç‡¶§‡¶§ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶° ‡¶¶‡¶ø‡¶§‡ßá ‡¶π‡¶¨‡ßá", "error");

        const images = [u1, u2, u3].filter(i => i);
        
        toggleLoading(true);
        try {
            await setDoc(doc(db, "app_settings", "slider"), { images });
            showToast("‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°‡¶æ‡¶∞ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶∏‡¶´‡¶≤!");
        } catch (e) { showToast("‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•", "error"); }
        toggleLoading(false);
    }

    // 3. Add Question (Fix: Added 'type' & changed collection to 'contents')
    window.addQuestion = async () => {
        const q = document.getElementById("qTitle").value;
        const a = document.getElementById("qAns").value;
        const img = document.getElementById("urlQ").value;

        if(!q || !a) return showToast("‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶ì ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®", "error");

        toggleLoading(true);
        try {
            // UPDATED COLLECTION NAME
            await addDoc(collection(db, "contents"), {
                type: 'question',
                question: q,
                answer: a,
                image: img || null,
                createdAt: Timestamp.now()
            });
            showToast("‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
            document.getElementById("qTitle").value = "";
            document.getElementById("qAns").value = "";
        } catch (e) { showToast("‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•", "error"); console.log(e); }
        toggleLoading(false);
    }

    // 4. Add MCQ (Fix: Added 'type', 'correct' value instead of index)
    window.addMCQ = async () => {
        const q = document.getElementById("mcqTitle").value;
        const o1 = document.getElementById("opt1").value;
        const o2 = document.getElementById("opt2").value;
        const o3 = document.getElementById("opt3").value;
        const o4 = document.getElementById("opt4").value;
        const correctIndex = document.getElementById("mcqCorrect").value; // 1,2,3,4

        if(!q || !o1 || !o2) return showToast("‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶ì ‡¶Ö‡¶®‡ßç‡¶§‡¶§ ‡ß®‡¶ü‡¶ø ‡¶Ö‡¶™‡¶∂‡¶® ‡¶¶‡¶ø‡¶®", "error");
        
        const options = [o1, o2, o3, o4].filter(o => o);
        // Find the actual text of the correct answer
        const correctValue = options[parseInt(correctIndex)-1];

        if(!correctValue) return showToast("‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶ü‡¶ø ‡¶Ö‡¶™‡¶∂‡¶®‡ßá ‡¶®‡ßá‡¶á", "error");

        toggleLoading(true);
        try {
            // UPDATED
            await addDoc(collection(db, "contents"), {
                type: 'mcq',
                question: q,
                options: options,
                correct: correctValue, // Save exact string for Main App matching
                createdAt: Timestamp.now()
            });
            showToast("MCQ ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
            document.getElementById("mcqTitle").value = "";
        } catch (e) { showToast("‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•", "error"); }
        toggleLoading(false);
    }

    // 5. Add True/False (Fix: Added 'type' & 'options' array for UI consistency)
    window.addTrueFalse = async () => {
        const title = document.getElementById("tfTitle").value;
        const correctVal = document.getElementById("tfCorrect").value; // "‡¶∏‡¶§‡ßç‡¶Ø" or "‡¶Æ‡¶ø‡¶•‡ßç‡¶Ø‡¶æ"

        if(!title) return showToast("‡¶¨‡¶æ‡¶ï‡ßç‡¶Ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®", "error");

        toggleLoading(true);
        try {
            // UPDATED
            await addDoc(collection(db, "contents"), {
                type: 'truefalse',
                question: title,
                options: ["‡¶∏‡¶§‡ßç‡¶Ø", "‡¶Æ‡¶ø‡¶•‡ßç‡¶Ø‡¶æ"], // Main app needs options array
                correct: correctVal,
                createdAt: Timestamp.now()
            });
            showToast("‡¶∏‡¶§‡ßç‡¶Ø/‡¶Æ‡¶ø‡¶•‡ßç‡¶Ø‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
            document.getElementById("tfTitle").value = "";
        } catch (e) { showToast("‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•", "error"); }
        toggleLoading(false);
    }

    // 6. Add Translate (Fix: Added 'type', mapped fields to 'question'/'answer')
    window.addTranslate = async () => {
        const bn = document.getElementById("transBn").value;
        const en = document.getElementById("transEn").value;

        if(!bn || !en) return showToast("‡¶â‡¶≠‡ßü ‡¶¨‡¶æ‡¶ï‡ßç‡¶Ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®", "error");

        toggleLoading(true);
        try {
            // UPDATED
            await addDoc(collection(db, "contents"), {
                type: 'translate',
                question: bn, // Main App shows 'question' as Bangla
                answer: en,   // Main App shows 'answer' as English
                createdAt: Timestamp.now()
            });
            showToast("‡¶Ö‡¶®‡ßÅ‡¶¨‡¶æ‡¶¶ ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
            document.getElementById("transBn").value = "";
            document.getElementById("transEn").value = "";
        } catch (e) { showToast("‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•", "error"); }
        toggleLoading(false);
    }

</script>
</body>
</html>