<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ - ‡¶Ö‡¶ü‡ßã ‡¶Æ‡ßá‡¶ï‡¶æ‡¶®‡¶ø‡¶ï</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    
    <style>
        body { background-color: #f0f2f5; font-family: 'Kalpurush', sans-serif; }
        .sidebar { min-height: 100vh; background: #343a40; color: white; }
        .nav-link { color: rgba(255,255,255,.8); cursor: pointer; margin-bottom: 5px; }
        .nav-link:hover, .nav-link.active { color: #fff; background: rgba(255,255,255,0.1); border-radius: 5px; }
        .card { border: none; shadow-sm: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.8); z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .hidden { display: none !important; }
        .item-list { max-height: 500px; overflow-y: auto; }
        .list-group-item { display: flex; justify-content: space-between; align-items: center; }
        .action-btn { cursor: pointer; margin-left: 10px; }
        .ebook-thumb { width: 60px; height: 80px; object-fit: cover; border: 1px solid #ddd; margin-right: 15px; border-radius: 4px; }
    </style>
</head>
<body>

<!-- Loading Spinner -->
<div id="loading" class="loading-overlay hidden">
    <div class="spinner-border text-primary" role="status"></div>
</div>

<!-- Login Section -->
<div id="loginSection" class="container mt-5" style="max-width: 400px;">
    <div class="card p-4">
        <h3 class="text-center mb-4">‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶á‡¶®</h3>
        <input type="email" id="adminEmail" class="form-control mb-3" placeholder="‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶á‡¶Æ‡ßá‡¶á‡¶≤">
        <input type="password" id="adminPass" class="form-control mb-3" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°">
        <button onclick="adminLogin()" class="btn btn-dark w-100">‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>
</div>

<!-- Dashboard Section -->
<div id="dashboardSection" class="container-fluid hidden">
    <div class="row">
        <!-- Sidebar -->
        <nav class="col-md-3 col-lg-2 d-md-block sidebar p-3 collapse show" id="sidebarMenu">
            <h5 class="mb-4 py-2 border-bottom">üîß ‡¶Æ‡ßá‡¶ï‡¶æ‡¶®‡¶ø‡¶ï ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®</h5>
            <ul class="nav flex-column">
                <li class="nav-item"><a class="nav-link active" onclick="showTab('keys')"><i class="fas fa-key me-2"></i> ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶ü‡¶ø‡¶≠‡ßá‡¶∂‡¶® ‡¶ï‡¶ø</a></li>
                <li class="nav-item"><a class="nav-link" onclick="showTab('slider')"><i class="fas fa-images me-2"></i> ‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶ú</a></li>
                <!-- New Ebook Option -->
                <li class="nav-item"><a class="nav-link" onclick="showTab('ebook')"><i class="fas fa-book-open me-2"></i> ‡¶á-‡¶¨‡ßÅ‡¶ï (Ebook)</a></li>
                
                <li class="nav-item"><a class="nav-link" onclick="showTab('questions')"><i class="fas fa-question-circle me-2"></i> ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® (General)</a></li>
                <li class="nav-item"><a class="nav-link" onclick="showTab('mcq')"><i class="fas fa-list-check me-2"></i> MCQ</a></li>
                <li class="nav-item"><a class="nav-link" onclick="showTab('truefalse')"><i class="fas fa-check-square me-2"></i> ‡¶∏‡¶§‡ßç‡¶Ø/‡¶Æ‡¶ø‡¶•‡ßç‡¶Ø‡¶æ</a></li>
                <li class="nav-item"><a class="nav-link" onclick="showTab('translate')"><i class="fas fa-language me-2"></i> ‡¶ü‡ßç‡¶∞‡¶æ‡¶®‡ßç‡¶∏‡¶≤‡ßá‡¶ü</a></li>
                <li class="nav-item mt-5"><a class="nav-link text-danger" onclick="logout()"><i class="fas fa-sign-out-alt me-2"></i> ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 py-4">
            
            <!-- Generate Keys Tab -->
            <div id="tab-keys" class="content-tab">
                <h3>üîë ‡¶≤‡¶æ‡¶á‡¶∏‡ßá‡¶®‡ßç‡¶∏ ‡¶ï‡¶ø ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <div class="card p-4 mt-3" style="max-width: 500px;">
                    <label class="form-label">‡¶Æ‡ßá‡ßü‡¶æ‡¶¶ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</label>
                    <select id="keyDuration" class="form-select mb-3">
                        <option value="7">‡ß≠ ‡¶¶‡¶ø‡¶®</option>
                        <option value="10">‡ßß‡ß¶ ‡¶¶‡¶ø‡¶®</option>
                        <option value="15">‡ßß‡ß´ ‡¶¶‡¶ø‡¶®</option>
                        <option value="30">‡ß©‡ß¶ ‡¶¶‡¶ø‡¶®</option>
                    </select>
                    <button onclick="generateKey()" class="btn btn-success">‡¶ú‡ßá‡¶®‡¶æ‡¶∞‡ßá‡¶ü ‡¶ï‡¶ø (Generate Key)</button>
                    
                    <div id="keyResult" class="alert alert-success mt-3 hidden">
                        <h4 id="newKeyDisplay" class="fw-bold"></h4>
                        <p class="mb-0">‡¶è‡¶á ‡¶ï‡¶ø ‡¶ü‡¶ø ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßá ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ‡¶¶‡¶ø‡¶®‡•§</p>
                    </div>
                </div>
                <h5 class="mt-4">‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶ï‡ßÄ (Keys)</h5>
                <ul class="list-group" id="keyListArea"></ul>
            </div>

            <!-- Slider Tab -->
            <div id="tab-slider" class="content-tab hidden">
                <h3>üñºÔ∏è ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°‡¶æ‡¶∞ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü</h3>
                <div class="card p-4 mt-3">
                    <p class="text-muted">‡¶á‡¶Æ‡ßá‡¶ú ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶¶‡¶ø‡¶®‡•§</p>
                    <div class="mb-3">
                        <label>‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶° ‡ßß</label>
                        <div class="input-group">
                            <input type="file" class="form-control" id="fileSlide1">
                            <button class="btn btn-outline-secondary" onclick="uploadImage('fileSlide1', 'urlSlide1')">‡¶Ü‡¶™‡¶≤‡ßã‡¶°</button>
                        </div>
                        <input type="text" id="urlSlide1" class="form-control mt-1" placeholder="Image URL">
                    </div>
                    <div class="mb-3">
                        <label>‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶° ‡ß®</label>
                        <div class="input-group">
                            <input type="file" class="form-control" id="fileSlide2">
                            <button class="btn btn-outline-secondary" onclick="uploadImage('fileSlide2', 'urlSlide2')">‡¶Ü‡¶™‡¶≤‡ßã‡¶°</button>
                        </div>
                        <input type="text" id="urlSlide2" class="form-control mt-1" placeholder="Image URL">
                    </div>
                    <div class="mb-3">
                        <label>‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶° ‡ß©</label>
                        <div class="input-group">
                            <input type="file" class="form-control" id="fileSlide3">
                            <button class="btn btn-outline-secondary" onclick="uploadImage('fileSlide3', 'urlSlide3')">‡¶Ü‡¶™‡¶≤‡ßã‡¶°</button>
                        </div>
                        <input type="text" id="urlSlide3" class="form-control mt-1" placeholder="Image URL">
                    </div>
                    <button onclick="updateSlider()" class="btn btn-primary">‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°‡¶æ‡¶∞ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                </div>
            </div>

            <!-- EBOOK TAB (UPDATED) -->
            <div id="tab-ebook" class="content-tab hidden">
                <h3>üìò ‡¶á-‡¶¨‡ßÅ‡¶ï ‡¶™‡ßá‡¶ú ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü</h3>
                
                <!-- Instruction Box -->
                <div class="alert alert-info border-start border-4 border-info">
                    <strong>‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶®‡¶ø‡ßü‡¶Æ‡¶æ‡¶¨‡¶≤‡ßÄ (‡¶ß‡¶æ‡¶∞‡¶æ‡¶¨‡¶æ‡¶π‡¶ø‡¶ï‡¶§‡¶æ ‡¶¨‡¶ú‡¶æ‡ßü ‡¶∞‡¶æ‡¶ñ‡ßÅ‡¶®):</strong>
                    <ul class="mb-0 small" style="list-style-type: none; padding-left: 0;">
                        <li>üìå <strong>‡ßß‡¶Æ ‡¶á‡¶Æ‡ßá‡¶ú:</strong> ‡¶ï‡¶≠‡¶æ‡¶∞ ‡¶™‡ßá‡¶ú (Cover Page)</li>
                        <li>üìå <strong>‡ß®‡ßü ‡¶á‡¶Æ‡ßá‡¶ú:</strong> ‡¶∏‡ßÇ‡¶ö‡¶ø‡¶™‡¶§‡ßç‡¶∞ (Index Page)</li>
                        <li>üìå <strong>‡ß©‡ßü ‡¶á‡¶Æ‡ßá‡¶ú ‡¶•‡ßá‡¶ï‡ßá:</strong> ‡¶Æ‡ßÇ‡¶≤ ‡¶¨‡¶á‡ßü‡ßá‡¶∞ ‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ ‡ßß ‡¶•‡ßá‡¶ï‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ...</li>
                    </ul>
                </div>

                <div class="card p-4 mt-3">
                    <input type="hidden" id="editIdEbook">
                    <label>‡¶á-‡¶¨‡ßÅ‡¶ï ‡¶™‡ßá‡¶ú ‡¶á‡¶Æ‡ßá‡¶ú (Upload Image)</label>
                    <div class="input-group mb-3">
                        <input type="file" class="form-control" id="fileEbook">
                        <button class="btn btn-outline-secondary" onclick="uploadImage('fileEbook', 'urlEbook')">‡¶Ü‡¶™‡¶≤‡ßã‡¶°</button>
                    </div>
                    <input type="text" id="urlEbook" class="form-control mb-3" placeholder="‡¶á‡¶Æ‡ßá‡¶ú ‡¶≤‡¶ø‡¶Ç‡¶ï...">
                    
                    <div class="d-flex gap-2">
                        <button onclick="saveEbook()" id="btnSaveEbook" class="btn btn-primary">‡¶™‡ßá‡¶ú ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                        <button onclick="resetForm('ebook')" id="btnCancelEbook" class="btn btn-secondary hidden">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                    </div>
                </div>

                <h5 class="mt-4">‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶™‡ßá‡¶ú‡¶∏‡¶Æ‡ßÇ‡¶π (‡¶ï‡ßç‡¶∞‡¶Æ ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ):</h5>
                <div class="list-group item-list" id="listEbook">Loading...</div>
            </div>

            <!-- Questions Tab -->
            <div id="tab-questions" class="content-tab hidden">
                <h3>‚ùì ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶Ø‡ßã‡¶ó/‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <div class="card p-4 mt-3">
                    <input type="hidden" id="editIdQ">
                    <input type="text" id="qTitle" class="form-control mb-2" placeholder="‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...">
                    <textarea id="qAns" class="form-control mb-2" rows="4" placeholder="‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></textarea>
                    
                    <label>‡¶õ‡¶¨‡¶ø (‡¶Ö‡¶™‡¶∂‡¶®‡¶æ‡¶≤)</label>
                    <div class="input-group mb-3">
                        <input type="file" class="form-control" id="fileQ">
                        <button class="btn btn-outline-secondary" onclick="uploadImage('fileQ', 'urlQ')">‡¶Ü‡¶™‡¶≤‡ßã‡¶°</button>
                    </div>
                    <input type="text" id="urlQ" class="form-control mb-3" placeholder="‡¶õ‡¶¨‡¶ø‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶∏‡¶¨‡ßá">
                    
                    <div class="d-flex gap-2">
                        <button onclick="saveQuestion()" id="btnSaveQ" class="btn btn-info text-white">‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                        <button onclick="resetForm('question')" id="btnCancelQ" class="btn btn-secondary hidden">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                    </div>
                </div>
                <h5 class="mt-4">‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡¶∏‡¶Æ‡ßÇ‡¶π:</h5>
                <div class="list-group item-list" id="listQuestions">Loading...</div>
            </div>

            <!-- MCQ Tab -->
            <div id="tab-mcq" class="content-tab hidden">
                <h3>üìù MCQ ‡¶Ø‡ßã‡¶ó/‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <div class="card p-4 mt-3">
                    <input type="hidden" id="editIdMCQ">
                    <input type="text" id="mcqTitle" class="form-control mb-3" placeholder="MCQ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®...">
                    <div class="row g-2 mb-3">
                        <div class="col-6"><input type="text" id="opt1" class="form-control" placeholder="‡¶Ö‡¶™‡¶∂‡¶® ‡ßß"></div>
                        <div class="col-6"><input type="text" id="opt2" class="form-control" placeholder="‡¶Ö‡¶™‡¶∂‡¶® ‡ß®"></div>
                        <div class="col-6"><input type="text" id="opt3" class="form-control" placeholder="‡¶Ö‡¶™‡¶∂‡¶® ‡ß©"></div>
                        <div class="col-6"><input type="text" id="opt4" class="form-control" placeholder="‡¶Ö‡¶™‡¶∂‡¶® ‡ß™"></div>
                    </div>
                    <label>‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶ï‡ßã‡¶®‡¶ü‡¶ø?</label>
                    <select id="mcqCorrect" class="form-select mb-3">
                        <option value="1">‡¶Ö‡¶™‡¶∂‡¶® ‡ßß</option>
                        <option value="2">‡¶Ö‡¶™‡¶∂‡¶® ‡ß®</option>
                        <option value="3">‡¶Ö‡¶™‡¶∂‡¶® ‡ß©</option>
                        <option value="4">‡¶Ö‡¶™‡¶∂‡¶® ‡ß™</option>
                    </select>
                    <div class="d-flex gap-2">
                        <button onclick="saveMCQ()" id="btnSaveMCQ" class="btn btn-warning">MCQ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                        <button onclick="resetForm('mcq')" id="btnCancelMCQ" class="btn btn-secondary hidden">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                    </div>
                </div>
                <h5 class="mt-4">‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ MCQ:</h5>
                <div class="list-group item-list" id="listMCQ">Loading...</div>
            </div>

            <!-- True False Tab -->
            <div id="tab-truefalse" class="content-tab hidden">
                <h3>‚úÖ ‡¶∏‡¶§‡ßç‡¶Ø / ‡¶Æ‡¶ø‡¶•‡ßç‡¶Ø‡¶æ ‡¶Ø‡ßã‡¶ó/‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <div class="card p-4 mt-3">
                    <input type="hidden" id="editIdTF">
                    <input type="text" id="tfTitle" class="form-control mb-3" placeholder="‡¶¨‡¶æ‡¶ï‡ßç‡¶Ø‡¶ü‡¶ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®...">
                    <select id="tfCorrect" class="form-select mb-3">
                        <option value="‡¶∏‡¶§‡ßç‡¶Ø">‡¶∏‡¶§‡ßç‡¶Ø (True)</option>
                        <option value="‡¶Æ‡¶ø‡¶•‡ßç‡¶Ø‡¶æ">‡¶Æ‡¶ø‡¶•‡ßç‡¶Ø‡¶æ (False)</option>
                    </select>
                    <div class="d-flex gap-2">
                        <button onclick="saveTrueFalse()" id="btnSaveTF" class="btn btn-success">‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                        <button onclick="resetForm('truefalse')" id="btnCancelTF" class="btn btn-secondary hidden">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                    </div>
                </div>
                <h5 class="mt-4">‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶∏‡¶§‡ßç‡¶Ø/‡¶Æ‡¶ø‡¶•‡ßç‡¶Ø‡¶æ:</h5>
                <div class="list-group item-list" id="listTF">Loading...</div>
            </div>

            <!-- Translate Tab -->
             <div id="tab-translate" class="content-tab hidden">
                <h3>üî§ ‡¶Ö‡¶®‡ßÅ‡¶¨‡¶æ‡¶¶ (Translate) ‡¶Ø‡ßã‡¶ó/‡¶è‡¶°‡¶ø‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</h3>
                <div class="card p-4 mt-3">
                    <input type="hidden" id="editIdTrans">
                    <div class="mb-2">
                        <label>‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ ‡¶¨‡¶æ‡¶ï‡ßç‡¶Ø</label>
                        <input type="text" id="transBn" class="form-control" placeholder="‡¶Ü‡¶Æ‡¶ø ‡¶Æ‡ßá‡¶ï‡¶æ‡¶®‡¶ø‡¶ï...">
                    </div>
                    <div class="mb-3">
                        <label>‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø ‡¶Ö‡¶®‡ßÅ‡¶¨‡¶æ‡¶¶</label>
                        <input type="text" id="transEn" class="form-control" placeholder="I am a mechanic...">
                    </div>
                    <div class="d-flex gap-2">
                        <button onclick="saveTranslate()" id="btnSaveTrans" class="btn btn-dark">‡¶Ö‡¶®‡ßÅ‡¶¨‡¶æ‡¶¶ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</button>
                        <button onclick="resetForm('translate')" id="btnCancelTrans" class="btn btn-secondary hidden">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                    </div>
                </div>
                <h5 class="mt-4">‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶Ö‡¶®‡ßÅ‡¶¨‡¶æ‡¶¶:</h5>
                <div class="list-group item-list" id="listTranslate">Loading...</div>
            </div>

        </main>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

<!-- Firebase SDK -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc, deleteDoc, collection, addDoc, Timestamp, query, where, onSnapshot, orderBy } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBEfs_yi_U5AObahTTLQGK5Sj4k1wSBXb0",
        authDomain: "ansar-vdp.firebaseapp.com",
        projectId: "ansar-vdp",
        storageBucket: "ansar-vdp.firebasestorage.app",
        messagingSenderId: "934221161236",
        appId: "1:934221161236:web:bd4797c63c4fd5418f9801"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // -- UTILITIES --
    window.showToast = (msg, type="success") => {
        let bg = type === "error" ? "red" : "green";
        Toastify({ text: msg, duration: 3000, style: { background: bg } }).showToast();
    }

    window.toggleLoading = (show) => {
        document.getElementById("loading").classList.toggle("hidden", !show);
    }

    window.showTab = (tabId) => {
        document.querySelectorAll('.content-tab').forEach(el => el.classList.add('hidden'));
        document.getElementById('tab-' + tabId).classList.remove('hidden');
        
        document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
        event.target.closest('.nav-link').classList.add('active');
    }

    // -- AUTH --
    window.adminLogin = async () => {
        const email = document.getElementById("adminEmail").value;
        const pass = document.getElementById("adminPass").value;
        toggleLoading(true);
        try {
            const userCred = await signInWithEmailAndPassword(auth, email, pass);
            checkIsAdmin(userCred.user.uid);
        } catch (error) {
            showToast("‡¶≤‡¶ó‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•! ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§", "error");
            toggleLoading(false);
        }
    }

    async function checkIsAdmin(uid) {
        const userDoc = await getDoc(doc(db, "users", uid));
        if(userDoc.exists() && userDoc.data().isAdmin === true) {
            document.getElementById("loginSection").classList.add("hidden");
            document.getElementById("dashboardSection").classList.remove("hidden");
            showToast("‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ");
            startListeners();
        } else {
            showToast("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶®‡ßá‡¶á!", "error");
            signOut(auth);
        }
        toggleLoading(false);
    }

    onAuthStateChanged(auth, (user) => {
        if(user) {
            checkIsAdmin(user.uid);
        } else {
            document.getElementById("loginSection").classList.remove("hidden");
            document.getElementById("dashboardSection").classList.add("hidden");
        }
    });

    window.logout = () => { signOut(auth); }

    // -- CLOUDINARY UPLOAD --
    window.uploadImage = async (inputId, outputId) => {
        const file = document.getElementById(inputId).files[0];
        if(!file) return showToast("‡¶õ‡¶¨‡¶ø ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®", "error");

        toggleLoading(true);
        const formData = new FormData();
        formData.append("file", file);
        formData.append("upload_preset", "ml_default");
        formData.append("cloud_name", "dntvrm1wn");

        try {
            let res = await fetch("https://api.cloudinary.com/v1_1/dntvrm1wn/image/upload", {
                method: "POST", body: formData
            });
            let data = await res.json();
            document.getElementById(outputId).value = data.secure_url;
            showToast("‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶∏‡¶´‡¶≤!");
        } catch (error) {
            showToast("‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•", "error");
        } finally {
            toggleLoading(false);
        }
    }

    // -- REALTIME DATA LISTENERS --
    function startListeners() {
        // Activation Keys
        onSnapshot(query(collection(db, "activation_keys"), orderBy("createdAt", "desc")), (snapshot) => {
            let html = "";
            snapshot.forEach(doc => {
                let d = doc.data();
                html += `<li class="list-group-item">
                    <span>${d.key} (${d.days} ‡¶¶‡¶ø‡¶®) - ${d.used ? '<span class="text-danger">‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡ßÉ‡¶§</span>' : '<span class="text-success">‡¶Ö‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡ßÉ‡¶§</span>'}</span>
                    <i class="fas fa-trash text-danger action-btn" onclick="deleteItem('activation_keys', '${doc.id}')"></i>
                </li>`;
            });
            document.getElementById("keyListArea").innerHTML = html;
        });

        // Contents (All Types)
        // Ebook Query: Must be ASC to maintain sequence (Cover -> Index -> Pages)
        onSnapshot(query(collection(db, "contents"), orderBy("createdAt", "asc")), (snapshot) => {
            let htmlQ = "", htmlMCQ = "", htmlTF = "", htmlTrans = "", htmlEbook = "";
            
            // Ebook Counters
            let ebookIndex = 0; 
            const toBangla = (n) => n.toString().replace(/\d/g, d => "‡ß¶‡ßß‡ß®‡ß©‡ß™‡ß´‡ß¨‡ß≠‡ßÆ‡ßØ"[d]);

            snapshot.forEach(docSnap => {
                let d = docSnap.data();
                let id = docSnap.id;
                
                // --- EBOOK LOGIC (NEW) ---
                if(d.type === 'ebook') {
                    ebookIndex++; 
                    let label = "";
                    let badgeClass = "";

                    if(ebookIndex === 1) {
                        label = "‡¶ï‡¶≠‡¶æ‡¶∞ ‡¶™‡ßá‡¶ú (Cover Page)";
                        badgeClass = "bg-primary";
                    } else if (ebookIndex === 2) {
                        label = "‡¶∏‡ßÇ‡¶ö‡¶ø‡¶™‡¶§‡ßç‡¶∞ (Index/TOC)";
                        badgeClass = "bg-info text-dark";
                    } else {
                        // Page starts from 1 (which is actual index 3)
                        let pageNum = ebookIndex - 2;
                        label = `‡¶Æ‡ßÇ‡¶≤ ‡¶™‡ßá‡¶ú: ${toBangla(pageNum)}`;
                        badgeClass = "bg-secondary";
                    }

                    htmlEbook += `
                    <div class="list-group-item">
                        <div class="d-flex align-items-center">
                            <img src="${d.image}" class="ebook-thumb">
                            <div>
                                <span class="badge ${badgeClass} mb-1">${label}</span><br>
                                <small class="text-muted">‡¶Ü‡¶™‡¶≤‡ßã‡¶°: ${d.createdAt?.toDate().toLocaleDateString()}</small>
                            </div>
                        </div>
                        <div>
                            <i class="fas fa-edit text-primary action-btn" onclick="editEbook('${id}', '${d.image}')"></i>
                            <i class="fas fa-trash text-danger action-btn" onclick="deleteItem('contents', '${id}')"></i>
                        </div>
                    </div>`;
                }

                // --- OTHER CONTENT (Reverse Order Logic) ---
                // We prepend (new + old) to show latest first for these types
                else if(d.type === 'question') {
                    htmlQ = `
                    <div class="list-group-item">
                        <div>
                            <strong>${d.question}</strong><br>
                            <small class="text-muted">${d.answer.substring(0,50)}...</small>
                        </div>
                        <div>
                            <i class="fas fa-edit text-primary action-btn" onclick="editQuestion('${id}', '${encodeURIComponent(d.question)}', '${encodeURIComponent(d.answer)}', '${d.image || ''}')"></i>
                            <i class="fas fa-trash text-danger action-btn" onclick="deleteItem('contents', '${id}')"></i>
                        </div>
                    </div>` + htmlQ;
                }
                else if(d.type === 'mcq') {
                    let opts = JSON.stringify(d.options);
                    htmlMCQ = `
                    <div class="list-group-item">
                        <div>
                            <strong>${d.question}</strong><br>
                            <small class="text-success">Correct: ${d.correct}</small>
                        </div>
                        <div>
                            <i class="fas fa-edit text-primary action-btn" onclick='editMCQ("${id}", "${encodeURIComponent(d.question)}", ${opts}, "${encodeURIComponent(d.correct)}")'></i>
                            <i class="fas fa-trash text-danger action-btn" onclick="deleteItem('contents', '${id}')"></i>
                        </div>
                    </div>` + htmlMCQ;
                }
                else if(d.type === 'truefalse') {
                    htmlTF = `
                    <div class="list-group-item">
                        <div>${d.question} <span class="badge bg-secondary">${d.correct}</span></div>
                        <div>
                            <i class="fas fa-edit text-primary action-btn" onclick="editTF('${id}', '${encodeURIComponent(d.question)}', '${d.correct}')"></i>
                            <i class="fas fa-trash text-danger action-btn" onclick="deleteItem('contents', '${id}')"></i>
                        </div>
                    </div>` + htmlTF;
                }
                else if(d.type === 'translate') {
                    htmlTrans = `
                    <div class="list-group-item">
                        <div>${d.question} <i class="fas fa-arrow-right"></i> ${d.answer}</div>
                        <div>
                            <i class="fas fa-edit text-primary action-btn" onclick="editTrans('${id}', '${encodeURIComponent(d.question)}', '${encodeURIComponent(d.answer)}')"></i>
                            <i class="fas fa-trash text-danger action-btn" onclick="deleteItem('contents', '${id}')"></i>
                        </div>
                    </div>` + htmlTrans;
                }
            });

            document.getElementById("listEbook").innerHTML = htmlEbook || "<p class='text-muted p-3'>‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßá‡¶ú ‡¶®‡ßá‡¶á</p>";
            document.getElementById("listQuestions").innerHTML = htmlQ || "<p class='text-muted p-3'>‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶®‡ßá‡¶á</p>";
            document.getElementById("listMCQ").innerHTML = htmlMCQ || "<p class='text-muted p-3'>‡¶ï‡ßã‡¶®‡ßã MCQ ‡¶®‡ßá‡¶á</p>";
            document.getElementById("listTF").innerHTML = htmlTF || "<p class='text-muted p-3'>‡¶ï‡ßã‡¶®‡ßã ‡¶§‡¶•‡ßç‡¶Ø ‡¶®‡ßá‡¶á</p>";
            document.getElementById("listTranslate").innerHTML = htmlTrans || "<p class='text-muted p-3'>‡¶ï‡ßã‡¶®‡ßã ‡¶Ö‡¶®‡ßÅ‡¶¨‡¶æ‡¶¶ ‡¶®‡ßá‡¶á</p>";
        });

        // Slider
        getDoc(doc(db, "app_settings", "slider")).then(snap => {
            if(snap.exists()) {
                const imgs = snap.data().images || [];
                if(imgs[0]) document.getElementById("urlSlide1").value = imgs[0];
                if(imgs[1]) document.getElementById("urlSlide2").value = imgs[1];
                if(imgs[2]) document.getElementById("urlSlide3").value = imgs[2];
            }
        });
    }

    // -- UNIVERSAL DELETE --
    window.deleteItem = async (colName, id) => {
        if(!confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶è‡¶ü‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?")) return;
        toggleLoading(true);
        try {
            await deleteDoc(doc(db, colName, id));
            showToast("‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶∏‡¶´‡¶≤!");
        } catch (e) { showToast("‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•", "error"); }
        toggleLoading(false);
    }

    // -- RESET FORM --
    window.resetForm = (type) => {
        if(type === 'ebook') {
            document.getElementById("editIdEbook").value = "";
            document.getElementById("urlEbook").value = "";
            document.getElementById("fileEbook").value = "";
            document.getElementById("btnSaveEbook").innerText = "‡¶™‡ßá‡¶ú ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®";
            document.getElementById("btnCancelEbook").classList.add("hidden");
        }
        else if(type === 'question') {
            document.getElementById("editIdQ").value = "";
            document.getElementById("qTitle").value = "";
            document.getElementById("qAns").value = "";
            document.getElementById("urlQ").value = "";
            document.getElementById("btnSaveQ").innerText = "‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®";
            document.getElementById("btnCancelQ").classList.add("hidden");
        }
        else if(type === 'mcq') {
            document.getElementById("editIdMCQ").value = "";
            document.getElementById("mcqTitle").value = "";
            ['opt1','opt2','opt3','opt4'].forEach(id => document.getElementById(id).value = "");
            document.getElementById("mcqCorrect").value = "1";
            document.getElementById("btnSaveMCQ").innerText = "MCQ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®";
            document.getElementById("btnCancelMCQ").classList.add("hidden");
        }
        else if(type === 'truefalse') {
            document.getElementById("editIdTF").value = "";
            document.getElementById("tfTitle").value = "";
            document.getElementById("tfCorrect").value = "‡¶∏‡¶§‡ßç‡¶Ø";
            document.getElementById("btnSaveTF").innerText = "‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®";
            document.getElementById("btnCancelTF").classList.add("hidden");
        }
        else if(type === 'translate') {
            document.getElementById("editIdTrans").value = "";
            document.getElementById("transBn").value = "";
            document.getElementById("transEn").value = "";
            document.getElementById("btnSaveTrans").innerText = "‡¶Ö‡¶®‡ßÅ‡¶¨‡¶æ‡¶¶ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®";
            document.getElementById("btnCancelTrans").classList.add("hidden");
        }
    }

    // -- EBOOK SAVE FUNCTION --
    window.editEbook = (id, img) => {
        document.getElementById("editIdEbook").value = id;
        document.getElementById("urlEbook").value = img;
        document.getElementById("btnSaveEbook").innerText = "‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®";
        document.getElementById("btnCancelEbook").classList.remove("hidden");
        document.body.scrollTop = 0; document.documentElement.scrollTop = 0;
    }

    window.saveEbook = async () => {
        const id = document.getElementById("editIdEbook").value;
        const img = document.getElementById("urlEbook").value;

        if(!img) return showToast("‡¶á‡¶Æ‡ßá‡¶ú ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®", "error");

        toggleLoading(true);
        try {
            const data = {
                type: 'ebook',
                image: img,
                createdAt: Timestamp.now()
            };

            if(id) {
                // ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßü Timestamp ‡¶ö‡ßá‡¶û‡ßç‡¶ú ‡¶π‡¶¨‡ßá ‡¶®‡¶æ ‡¶Ø‡¶æ‡¶§‡ßá ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶†‡¶ø‡¶ï ‡¶•‡¶æ‡¶ï‡ßá
                delete data.createdAt; 
                await updateDoc(doc(db, "contents", id), data);
                showToast("‡¶™‡ßá‡¶ú ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
            } else {
                await addDoc(collection(db, "contents"), data);
                showToast("‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßá‡¶ú ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
            }
            resetForm('ebook');
        } catch (e) { showToast("‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: " + e.message, "error"); }
        toggleLoading(false);
    }

    // -- OTHER SAVE FUNCTIONS --
    window.editQuestion = (id, q, a, img) => {
        document.getElementById("editIdQ").value = id;
        document.getElementById("qTitle").value = decodeURIComponent(q);
        document.getElementById("qAns").value = decodeURIComponent(a);
        document.getElementById("urlQ").value = img;
        document.getElementById("btnSaveQ").innerText = "‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®";
        document.getElementById("btnCancelQ").classList.remove("hidden");
        document.body.scrollTop = 0; document.documentElement.scrollTop = 0;
    }

    window.saveQuestion = async () => {
        const id = document.getElementById("editIdQ").value;
        const q = document.getElementById("qTitle").value;
        const a = document.getElementById("qAns").value;
        const img = document.getElementById("urlQ").value;
        if(!q || !a) return showToast("‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶ì ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®", "error");
        toggleLoading(true);
        try {
            const data = { type: 'question', question: q, answer: a, image: img || null, createdAt: Timestamp.now() };
            if(id) { delete data.createdAt; await updateDoc(doc(db, "contents", id), data); showToast("‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶∏‡¶´‡¶≤!"); }
            else { await addDoc(collection(db, "contents"), data); showToast("‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); }
            resetForm('question');
        } catch (e) { showToast("‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•", "error"); }
        toggleLoading(false);
    }

    window.editMCQ = (id, q, options, correct) => {
        document.getElementById("editIdMCQ").value = id;
        document.getElementById("mcqTitle").value = decodeURIComponent(q);
        const decodedCorrect = decodeURIComponent(correct);
        if(options[0]) document.getElementById("opt1").value = options[0];
        if(options[1]) document.getElementById("opt2").value = options[1];
        if(options[2]) document.getElementById("opt3").value = options[2];
        if(options[3]) document.getElementById("opt4").value = options[3];
        let correctIndex = options.indexOf(decodedCorrect) + 1;
        if(correctIndex > 0) document.getElementById("mcqCorrect").value = correctIndex;
        document.getElementById("btnSaveMCQ").innerText = "‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®";
        document.getElementById("btnCancelMCQ").classList.remove("hidden");
        document.body.scrollTop = 0; document.documentElement.scrollTop = 0;
    }

    window.saveMCQ = async () => {
        const id = document.getElementById("editIdMCQ").value;
        const q = document.getElementById("mcqTitle").value;
        const o1 = document.getElementById("opt1").value;
        const o2 = document.getElementById("opt2").value;
        const o3 = document.getElementById("opt3").value;
        const o4 = document.getElementById("opt4").value;
        const correctIndex = document.getElementById("mcqCorrect").value;
        if(!q || !o1 || !o2) return showToast("‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶ì ‡¶Ö‡¶®‡ßç‡¶§‡¶§ ‡ß®‡¶ü‡¶ø ‡¶Ö‡¶™‡¶∂‡¶® ‡¶¶‡¶ø‡¶®", "error");
        const options = [o1, o2, o3, o4].filter(o => o);
        const correctValue = options[parseInt(correctIndex)-1];
        if(!correctValue) return showToast("‡¶∏‡¶†‡¶ø‡¶ï ‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶ü‡¶ø ‡¶Ö‡¶™‡¶∂‡¶®‡ßá ‡¶®‡ßá‡¶á", "error");
        toggleLoading(true);
        try {
            const data = { type: 'mcq', question: q, options: options, correct: correctValue, createdAt: Timestamp.now() };
            if(id) { delete data.createdAt; await updateDoc(doc(db, "contents", id), data); showToast("MCQ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); }
            else { await addDoc(collection(db, "contents"), data); showToast("MCQ ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); }
            resetForm('mcq');
        } catch (e) { showToast("‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•", "error"); }
        toggleLoading(false);
    }

    window.editTF = (id, q, correct) => {
        document.getElementById("editIdTF").value = id;
        document.getElementById("tfTitle").value = decodeURIComponent(q);
        document.getElementById("tfCorrect").value = correct;
        document.getElementById("btnSaveTF").innerText = "‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®";
        document.getElementById("btnCancelTF").classList.remove("hidden");
        document.body.scrollTop = 0; document.documentElement.scrollTop = 0;
    }

    window.saveTrueFalse = async () => {
        const id = document.getElementById("editIdTF").value;
        const title = document.getElementById("tfTitle").value;
        const correctVal = document.getElementById("tfCorrect").value;
        if(!title) return showToast("‡¶¨‡¶æ‡¶ï‡ßç‡¶Ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®", "error");
        toggleLoading(true);
        try {
            const data = { type: 'truefalse', question: title, options: ["‡¶∏‡¶§‡ßç‡¶Ø", "‡¶Æ‡¶ø‡¶•‡ßç‡¶Ø‡¶æ"], correct: correctVal, createdAt: Timestamp.now() };
            if(id) { delete data.createdAt; await updateDoc(doc(db, "contents", id), data); showToast("‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); }
            else { await addDoc(collection(db, "contents"), data); showToast("‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); }
            resetForm('truefalse');
        } catch (e) { showToast("‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•", "error"); }
        toggleLoading(false);
    }

    window.editTrans = (id, bn, en) => {
        document.getElementById("editIdTrans").value = id;
        document.getElementById("transBn").value = decodeURIComponent(bn);
        document.getElementById("transEn").value = decodeURIComponent(en);
        document.getElementById("btnSaveTrans").innerText = "‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®";
        document.getElementById("btnCancelTrans").classList.remove("hidden");
        document.body.scrollTop = 0; document.documentElement.scrollTop = 0;
    }

    window.saveTranslate = async () => {
        const id = document.getElementById("editIdTrans").value;
        const bn = document.getElementById("transBn").value;
        const en = document.getElementById("transEn").value;
        if(!bn || !en) return showToast("‡¶â‡¶≠‡ßü ‡¶¨‡¶æ‡¶ï‡ßç‡¶Ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®", "error");
        toggleLoading(true);
        try {
            const data = { type: 'translate', question: bn, answer: en, createdAt: Timestamp.now() };
            if(id) { delete data.createdAt; await updateDoc(doc(db, "contents", id), data); showToast("‡¶Ö‡¶®‡ßÅ‡¶¨‡¶æ‡¶¶ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); }
            else { await addDoc(collection(db, "contents"), data); showToast("‡¶Ö‡¶®‡ßÅ‡¶¨‡¶æ‡¶¶ ‡¶Ø‡ßã‡¶ó ‡¶π‡ßü‡ßá‡¶õ‡ßá!"); }
            resetForm('translate');
        } catch (e) { showToast("‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•", "error"); }
        toggleLoading(false);
    }

    window.generateKey = async () => {
        const days = document.getElementById("keyDuration").value;
        const newKey = "AUTO-" + Math.floor(100000 + Math.random() * 900000); 
        toggleLoading(true);
        try {
            await addDoc(collection(db, "activation_keys"), { key: newKey, days: parseInt(days), used: false, createdAt: Timestamp.now() });
            document.getElementById("newKeyDisplay").innerText = newKey;
            document.getElementById("keyResult").classList.remove("hidden");
            showToast("‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶ø ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
        } catch (e) { showToast("‡¶è‡¶∞‡¶∞ ‡¶π‡ßü‡ßá‡¶õ‡ßá", "error"); } finally { toggleLoading(false); }
    }

    window.updateSlider = async () => {
        const u1 = document.getElementById("urlSlide1").value;
        const u2 = document.getElementById("urlSlide2").value;
        const u3 = document.getElementById("urlSlide3").value;
        if(!u1) return showToast("‡¶Ö‡¶®‡ßç‡¶§‡¶§ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶° ‡¶¶‡¶ø‡¶§‡ßá ‡¶π‡¶¨‡ßá", "error");
        const images = [u1, u2, u3].filter(i => i);
        toggleLoading(true);
        try { await setDoc(doc(db, "app_settings", "slider"), { images }); showToast("‡¶∏‡ßç‡¶≤‡¶æ‡¶á‡¶°‡¶æ‡¶∞ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶∏‡¶´‡¶≤!"); }
        catch (e) { showToast("‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•", "error"); }
        toggleLoading(false);
    }

</script>
</body>
</html>